### Домашнее задание к занятию "10.06. Инцидент-менеджмент"

https://github.com/netology-code/mnt-homeworks/tree/master/10-monitoring-06-incident-management

Раздел | Описание
------------ | -------------
Краткое описание инцидента | 21 октября в 22:52 UTC плановые технические работы привели к потере связи между сетевым центром на восточном побережье США и ЦОДом на восточном побережье США. Связь между ними была восстановлена за 43 сек, но сбой привел к ухудшению обслуживания на 24 часа 11 минут.
Предшествующие события | Плановые работы по замене вышедшего из строя оптического оборудования 100G
Причина инцидента | Прерывание связи между двумя дата-центрами привело к несогласованности данных
Воздействие | Инцидент повлиял только на метаданные веб-сайтов, хранящиеся в базах данных MySQL, такие как Issue и PR, не работали web-хуки
Обнаружение | Внутренние системы мониторинга начали генерировать предупреждения, указывающие на то, что в системах возникло множество неисправностей. Запросы к API Orchestrator показали топологию репликации базы данных, которая включала только серверы из ЦОДа на западном побережье США.
Реакция | Разработчики решили вручную заблокировать внутренние инструменты развертывания, чтобы предотвратить внесение дополнительных изменений. Сначала команда перевела сайт в желтый статус, потом приняла решение перевести в красный.
Восстановление | Необходимо было выполнить восстановление из резервных копий, синхронизировать, вернуться к стабильной топологии сервиса и возобновить обработку заданий в очереди.
Таймлайн | <ul> <li> 2018 October 21 22:52 UTC Потеря связи между ЦОДами </li> <li> 2018 October 21 22:54 UTC Внутренние системы мониторинга начали генерировать предупреждения </li> <li> 2018 October 21 23:07 UTC Команда разработчиков вручную заблокировала внутренние инструменты развертывания, чтобы предотвратить внесение каких-либо дополнительных изменений. </li> <li> 2018 October 21 23:13 UTC Были приглашены дополнительные инженеры из группы разработки бд GitHub. Они начали исследовать текущее состояние, чтобы определить, какие действия необходимо предпринять, чтобы вручную настроить бд Восточного побережья США в качестве основной для каждого кластера и перестроить топологию репликации. </li> <li> 2018 October 21 23:19 UTC Стратегия - отдавать приоритет целостности данных над удобством использования сайта и временем восстановления. </li> <li> 2018 October 22 00:05 UTC Запустили план по восстановлению резервных копий, синхронизации реплик в обоих ЦОД, возвращению к стабильной топологии обслуживания и возобновлению обработки заданий в очереди. Обновлен статус для информирования пользователей. </li> <li> 2018 October 22 00:41 UTC Был запущен процесс резервного копирования всех затронутых кластеров MySQL, и инженеры следили за его выполнением. </li> <li> 22 октября 2018 06:51 UTC Несколько кластеров завершили восстановление из резервных копий в ЦОД на востоке и начали репликацию новых данных с западного побережья. Кластеры баз данных большего размера все еще перестраивались. </li> <li> 2018 October 22 07:46 UTC GitHub опубликовал сообщение в блоге, чтобы предоставить больше контекста. </li> <li> 2018 October 22 11:12 UTC Все первичные базы данных снова установлены на Восточном побережье США. Это привело к тому, что сайт стал намного более отзывчивым, это повысило производительность, но десятки реплик чтения бд отставали на несколько часов от основной. Это привело к тому, что пользователи увидели противоречивые данные. </li> <li> 2018 October 22 13:15 UTC  Группа реагирования на инциденты провела обсуждение дальнейших действий. Задержки репликации увеличились из-за пиковой нагрузки. </li> <li> 2018 October 22 16:24 UTC После того, как реплики были синхронизированы, выполнили аварийное переключение на исходную топологию, решив немедленные проблемы с задержкой/доступностью. Статус остался красным. </li> <li> 2018 October 22 16:45 UTC Произвели балансировку увеличившейся нагрузки и начали обработки очереди web-хуков и сборок страниц. </li> <li> Все незавершенные веб-перехватчики и сборки страниц были обработаны, и была подтверждена целостность и правильная работа всех систем. Статус был обновлен до зеленого. </li> </ul>
Последующие действия | По результатам анализа данного инцидента были сделаны выводы и технические доработки. Необходимо перенастроить конфигурацию Orchestrator для предотвращения перехода главной БД в другой регион. Ускорить переход на новый механизм отчётности о статусе инцидента. Обеспечено избыточное резервирование данных ЦОД для увеличения надёжности. Начать систематические проверки сценариев сбоя и возможных путей их решения до того, как их увидят пользователи.
